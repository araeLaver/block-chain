name: ğŸ“ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ë¬¸ì„œí™”

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  update-commit-history:
    name: ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°

      - name: ğŸ“Š ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ìƒì„±
        run: |
          echo "# ğŸ“œ í”„ë¡œì íŠ¸ ì»¤ë°‹ íˆìŠ¤í† ë¦¬" > COMMIT_HISTORY.md
          echo "" >> COMMIT_HISTORY.md
          echo "> ì´ ë¬¸ì„œëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. (GitHub Actions)" >> COMMIT_HISTORY.md
          echo "" >> COMMIT_HISTORY.md
          echo "## ğŸ“Š í†µê³„" >> COMMIT_HISTORY.md
          echo "" >> COMMIT_HISTORY.md

          TOTAL_COMMITS=$(git rev-list --count HEAD)
          CONTRIBUTORS=$(git log --format='%aN' | sort -u | wc -l)
          FIRST_COMMIT=$(git log --reverse --format='%ai' | head -1 | cut -d' ' -f1)
          LAST_COMMIT=$(git log --format='%ai' | head -1 | cut -d' ' -f1)

          echo "- **ì´ ì»¤ë°‹ ìˆ˜**: $TOTAL_COMMITS" >> COMMIT_HISTORY.md
          echo "- **ê¸°ì—¬ì ìˆ˜**: $CONTRIBUTORS" >> COMMIT_HISTORY.md
          echo "- **ì²« ì»¤ë°‹**: $FIRST_COMMIT" >> COMMIT_HISTORY.md
          echo "- **ìµœê·¼ ì»¤ë°‹**: $LAST_COMMIT" >> COMMIT_HISTORY.md
          echo "" >> COMMIT_HISTORY.md

          echo "## ğŸ“ ìƒì„¸ ì»¤ë°‹ íˆìŠ¤í† ë¦¬" >> COMMIT_HISTORY.md
          echo "" >> COMMIT_HISTORY.md

          git log --pretty=format:'### %s%n%n- **ì‘ì„±ì**: %an%n- **ë‚ ì§œ**: %ai%n- **ì»¤ë°‹**: `%h`%n%n```%n%b%n```%n%n----%n' --reverse >> COMMIT_HISTORY.md

      - name: ğŸ“¤ ë³€ê²½ì‚¬í•­ ì»¤ë°‹
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add COMMIT_HISTORY.md

          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            git commit -m "ìë™ ìƒì„±: ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸ ğŸ“"
            git push
          fi
